# ç”¨æµæ”¶é›†æ•°æ®

[TOC]

## é¢„å®šä¹‰æ”¶é›†å™¨

é¢„å®šä¹‰æ”¶é›†å™¨ä¸»è¦æä¾›äº†ä¸‰å¤§åŠŸèƒ½ï¼š

- å°†æµå…ƒç´ è§„çº¦å’Œæ±‡æ€»ä¸ºä¸€ä¸ªå€¼
- å…ƒç´ åˆ†ç»„
- å…ƒç´ åˆ†åŒº

## è§„çº¦å’Œæ±‡æ€»

```java
@Data
@AllArgsConstructor
public class Dish {
    private String name;
    private boolean vegetarian;
    private int calories;
    private Type type;

    public enum Type {
        MEAT, FISH, OTHER
    }
}
// ... 
List<Dish> menu = Arrays.asList(
        new Dish("pork", false, 800, Dish.Type.MEAT),
        new Dish("beef", false, 700, Dish.Type.MEAT),
        new Dish("chicken", false, 400, Dish.Type.MEAT),
        new Dish("french fries", true, 530, Dish.Type.OTHER),
        new Dish("rice", true, 350, Dish.Type.OTHER),
        new Dish("season fruit", true, 120, Dish.Type.OTHER),
        new Dish("pizza", true, 550, Dish.Type.OTHER),
        new Dish("prawns", false, 300, Dish.Type.FISH),
        new Dish("salmon", false, 450, Dish.Type.FISH)
);
```

æ•°ä¸€æ•°èœè‚´é‡Œé¢æœ‰å¤šå°‘ç§èœï¼š

```java
long howManyDishes = menu.stream().collect(Collectors.counting());
// æˆ–è€…æœ‰å¦å¤–ä¸€ç§å½¢å¼
long howManyDishes = menu.stream().count();
```

### æŸ¥æ‰¾æœ€å¤§å€¼æœ€å°å€¼

`Collectors.maxBy`å’Œ`Collectors.minBy`å¯ä»¥è®¡ç®—æµä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚

```java
Optional<Dish> mostCalories = menu.stream()
    .collect(Collectors.maxBy(Comparator.comparing(Dish::getCalories)));
```

### æ±‡æ€»

æ±‡æ€»æœ‰ä¸‰ç§æ±‚å’Œæ–¹æ³• ï¼š`summingInt`ã€`summingLong`ã€`summingDouble`

ä¾‹å¦‚ ï¼šæ±‚å‡ºå½©è›‹åˆ—è¡¨ä¸­çš„æ€»çƒ­é‡

```java
int totalCalories = menu.stream().collect(Collectors.summingInt(Dish::getCalories));
```

é™¤äº†æ±‚å’Œä¹‹å¤–ï¼Œè¿˜æœ‰`averagingInt`ã€`averagingLong`ã€`averagingDouble`è®¡ç®—å¹³å‡å€¼

```java
double averageCalories = menu.stream().collect(Collectors.averagingDouble(Dish::getCalories));
```

é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¸Œæœ›è·å–åˆ°æœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ ï¼š`summarizingInt`ã€`summarizingDouble`ã€`summarizingLong`

```java
IntSummaryStatistics intSummaryStatistics = menu.stream()
    .collect(Collectors.summarizingInt(Dish::getCalories));
System.out.println(intSummaryStatistics);
// IntSummaryStatistics{count=9, sum=4200, min=120, average=466.666667, max=800}
```

### é“¾æ¥å­—ç¬¦ä¸²

`joining`å·¥å‚æ–¹æ³•ä¼šæŠŠå¯¹æµä¸­æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨`toString`æ–¹æ³•å¾—åˆ°çš„å­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

```java
String joinString = menu.stream().map(Dish::getName).collect(Collectors.joining(","));
// pork, beef, chicken, french fries, rice, season fruit, pizza, prawns, salmon
```

### å¹¿ä¹‰çš„è§„çº¦æ±‡æ€»

```java
public static <T, U>
Collector<T, ?, U> reducing(U identity,
                            Function<? super T, ? extends U> mapper,
                            BinaryOperator<U> op) {
    // ......
}
```

`reduce`æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•° ï¼š

1. è§„çº¦æ“ä½œçš„åˆå§‹å€¼ï¼Œä¹Ÿæ˜¯å½“æµä¸­æ²¡æœ‰å…ƒç´ æ—¶å€™çš„è¿”å›å€¼
2. å‡½æ•°
3. `BinaryOperator`ï¼šå°†ä¸¤ä¸ªé¡¹ç›®ç´¯ç§¯æˆä¸€ä¸ªåŒç±»å‹çš„å€¼

åŒæ—¶ï¼Œ`reducing`æ–¹æ³•è¿˜æœ‰å•å‚æ•°çš„å½¢å¼ï¼Œä¾‹å¦‚åœ¨ä¸‹ä¾‹ä¸­æ‰¾åˆ°å¡è·¯é‡Œæœ€é«˜çš„èœ ï¼š

```java
Optional<Dish> mostCalories = 
	menu.stream()
    .collect(Collectors.reducing((d1, d2) -> d1.getCalories() > d2.getCalories() ? d1 : d2));
```

### æ”¶é›†ä¸è§„çº¦

`Stream`æ¥å£ä¸­çš„`collect`å’Œ`reduce`æ–¹æ³•æœ‰ä½•ä¸åŒ ï¼Ÿ

ä½ å¯ä»¥åƒä¸‹é¢ä¸€æ ·ä½¿ç”¨`reduce`æ–¹æ³•æ¥å®ç°`toListCollector`æ‰€åšçš„å·¥ä½œ ï¼š

```java
ArrayList<String> result = stream.reduce(new ArrayList<String>(), (list, s) -> {
    list.add(s);
    return list;
}, (l1, l2) -> {
    l1.addAll(l2);
    return l1;
});
```

è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªé—®é¢˜ ï¼šè¯­ä¹‰é—®é¢˜å’Œå®é™…é—®é¢˜ã€‚

- è¯­ä¹‰ ï¼š`reduce`æ–¹æ³•æ—¨åœ¨æŠŠä¸¤ä¸ªå€¼ç»“åˆèµ·æ¥å½¢æˆä¸€ä¸ªæ–°å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯å˜çš„è§„çº¦ã€‚ä¸æ­¤ç›¸åï¼Œ`collect`æ–¹æ³•çš„è®¾è®¡å°±æ˜¯è¦æ”¹å˜å®¹å™¨ï¼Œä»è€Œç´¯ç§¯è¦è¾“å‡ºçš„ç»“æœã€‚
- å®é™…é—®é¢˜ ï¼š`reduce`å½’çº¦è¿‡ç¨‹ä¸èƒ½å¹¶è¡Œå·¥ä½œï¼Œå› ä¸ºç”±å¤šä¸ªçº¿ç¨‹å¹¶å‘ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®ç»“æ„å¯èƒ½ä¼šç ´å`List`æœ¬èº«ã€‚`collect`é€‚åˆè¡¨è¾¾å¯å˜å®¹å™¨çš„è§„çº¦ï¼Œå®ƒé€‚åˆå¹¶è¡Œæ“ä½œ

## åˆ†ç»„

ä¾‹å­ ï¼šæŠŠèœå•ä¸­çš„èœæŒ‰ç…§ç±»å‹è¿›è¡Œåˆ†ç±» 

```java
Map<Dish.Type, List<Dish>> dishesByType = 
    menu.stream()
    	.collect(Collectors.groupingBy(Dish::getType));
```

ä¾‹å­ ï¼šæŠŠçƒ­é‡ä¸åˆ°400å¡è·¯é‡Œçš„èœåˆ’åˆ†ä¸ºâ€œä½çƒ­é‡â€ï¼ŒæŠŠçƒ­é‡400åˆ°700çš„èœåˆ’åˆ†ä¸ºæ™®é€šï¼ŒæŠŠé«˜äº700çš„åˆ’åˆ†ä¸ºâ€œé«˜çƒ­é‡â€ï¼Œä½ éœ€è¦æŒ‰ç…§é£Ÿç‰©çƒ­é‡é«˜ä½è¿›è¡Œåˆ†ç»„

```java
public enum CaloricLevel {
    DIET, NORMAL, FAT
}
// ......
Map<CaloricLevel, List<Dish>> caloricLevelListMap = 
    	menu.stream()
        .collect(Collectors.groupingBy(d -> {
            if (d.getCalories() <= 400) return CaloricLevel.DIET;
            else if (d.getCalories() <= 700) return CaloricLevel.NORMAL;
            return CaloricLevel.FAT;
        }));
```

### å¤šçº§åˆ†ç»„

è¦å®ç°å¤šçº§åˆ†ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç”±åŒå‚æ•°ç‰ˆæœ¬çš„`Collectors.groupingBy`å·¥å‚æ–¹æ³•åˆ›å»ºçš„æ”¶é›†å™¨ï¼Œå®ƒé™¤äº†æ™®é€šçš„åˆ†ç±»å‡½æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¥å—`collector`ç±»å‹çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

å¦‚æœè¦è¿›è¡Œå¤šçº§åˆ†ç»„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªå†…å±‚`groupingBy`ä¼ é€’ç»™ä¸€ä¸ªå¤–å±‚`groupingBy`

```java
Map<Dish.Type, Map<CaloricLevel, List<Dish>>> typeMapMap = menu.stream().collect(
        Collectors.groupingBy(Dish::getType, Collectors.groupingBy(d -> {
            if (d.getCalories() <= 400) return CaloricLevel.DIET;
            else if (d.getCalories() <= 700) return CaloricLevel.NORMAL;
            return CaloricLevel.FAT;
        }))
);
// æ‰“å°å¦‚ä¸‹å†…å®¹ 
{MEAT={DIET=[chicken], NORMAL=[beef], FAT=[pork]},
FISH={DIET=[prawns], NORMAL=[salmon]},
OTHER={DIET=[rice, seasonal fruit], NORMAL=[french fries, pizza]}}
```

### æŒ‰å­ç»„æ”¶é›†æ•°æ®

åœ¨å¤šçº§åˆ†ç»„ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†`groupingBy`æ–¹æ³•å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•° ï¼š

```java
public static <T, K, A, D>
Collector<T, ?, Map<K, D>> groupingBy(Function<? super T, ? extends K> classifier,
                                      Collector<? super T, A, D> downstream) {
	// ......
}
```

ç¬¬äºŒä¸ªå‚æ•°ä¸ä¸€å®šæ˜¯`groupingBy`

ä¾‹å¦‚ï¼Œæ•°ä¸€æ•°èœå•ä¸­æ¯ä¸€ç±»èœæœ‰å¤šå°‘ä¸ª ï¼š

```java
 Map<Dish.Type, Long> integerMap = 
     menu.stream()
     .collect(Collectors.groupingBy(Dish::getType, Collectors.counting()));
```

ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾èœå•ä¸­æ¯ä¸€ç±»èœè‚´ä¸­çƒ­é‡æœ€é«˜çš„ ï¼š

```java
Map<Dish.Type, Optional<Dish>> mostCaloriesByType =
        menu.stream().collect(
                Collectors.groupingBy(
                        Dish::getType, Collectors.maxBy(Comparator.comparing(Dish::getCalories)))
        );
mostCaloriesByType.forEach((k, v) -> {
    System.out.println(k + " : " + v.get().getName());
});
```

æ‰“å°å¦‚ä¸‹å†…å®¹ ï¼š

```
OTHER : pizza
FISH : salmon
MEAT : pork
```

### æŠŠæ”¶é›†å™¨çš„ç»“æœè½¬æ¢ä¸ºå¦å¤–ä¸€ç§ç±»å‹

å¦‚æœä½ éœ€è¦<u>æŠŠæ”¶é›†å™¨è¿”å›çš„ç»“æœè½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹</u>ï¼Œä½ å¯ä»¥ä½¿ç”¨`Collectors.collectingAndThen`å·¥å‚æ–¹æ³•è¿”å›çš„æ”¶é›†å™¨

```java
// æŸ¥æ‰¾æ¯ä¸€ç§ç±»å‹ä¸­çƒ­é‡æœ€é«˜çš„èœ
Map<Dish.Type, Dish> dishMap = menu.stream().collect(
        Collectors.groupingBy(
                Dish::getType, Collectors.collectingAndThen(
                        Collectors.maxBy(
                                Comparator.comparingInt(Dish::getCalories))
                        , Optional::get
                )
        )
);
```

### ä¸`groupingBy`è”åˆä½¿ç”¨çš„å…¶ä»–æ”¶é›†å™¨çš„ä¾‹å­

ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨`groupingBy`å·¥å‚æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ”¶é›†å™¨å°†ä¼šå¯¹åˆ†åˆ°åŒä¸€ç»„çš„æ‰€æœ‰å…ƒç´ æ‰§è¡Œè¿›ä¸€æ­¥çš„è§„çº¦æ“ä½œã€‚

ä¾‹å¦‚ ï¼šå¯¹æ¯ä¸€ç»„çš„èœè‚´çƒ­é‡æ±‚å’Œ 

```java
// å¯¹æ¯ä¸€ç»„èœè‚´çƒ­é‡æ±‚å’Œ
Map<Dish.Type, Long> typeLongMap = menu.stream().collect(Collectors.groupingBy(
        Dish::getType, Collectors.summingLong(Dish::getCalories)
));
System.out.println(typeLongMap);
```

ç„¶è€Œå¸¸å¸¸ä¸`groupingBy`è”åˆä½¿ç”¨çš„å¦å¤–ä¸€ä¸ªæ”¶é›†å™¨æ˜¯`mapping`æ–¹æ³•ç”Ÿæˆçš„ã€‚`mapping`æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•° ï¼š

- ä¸€ä¸ªå‡½æ•°å¯¹æµä¸­çš„å…ƒç´ åšè½¬æ¢
- å°†è½¬æ¢çš„ç»“æœæ”¶é›†èµ·æ¥

ğŸ˜µå…¶ç›®çš„æ˜¯åœ¨æ”¶é›†ç»“æœä¹‹å‰ï¼Œå¯¹æ¯ä¸€ä¸ªè¾“å…¥å…ƒç´ åº”ç”¨ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥è®©æ¥æ”¶ç‰¹å®šç±»å‹å…ƒç´ çš„æ”¶é›†å™¨é€‚åº”ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼šå¯¹äºæ¯ç§ç±»å‹çš„Typeï¼Œèœå•ä¸­éƒ½æœ‰å“ªäº›`CaloricLevel`

```java
Map<Dish.Type, Set<CaloricLevel>> typeSetMap =
        menu.stream()
    	.collect(Collectors.groupingBy(
                Dish::getType, Collectors.mapping(
                        dish -> {
                            if (dish.getCalories() <= 400) return CaloricLevel.DIET;
                            else if (dish.getCalories() <= 700) return CaloricLevel.NORMAL;
                            return CaloricLevel.FAT;
                        }, Collectors.toSet()
                )
        ));
```

åœ¨`mapping`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¬æ¢å‡½æ•°å°†`Dish`æ˜ å°„æˆäº†å®ƒçš„`CaloricLevel`ï¼Œç”Ÿæˆçš„`CaloricLevel`ä¼ é€’ç»™äº†`toSet`æ”¶é›†å™¨ï¼Œå®ƒå’Œ`toList`ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯æŠŠæµä¸­çš„å…ƒç´ ç´¯ç§¯åˆ°äº†ä¸€ä¸ª`Set`è€Œä¸æ˜¯`List`ä¸­ï¼Œä»¥ä¾¿ä¿ç•™ä¸åŒçš„å€¼ã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯¹äºè¿”å›çš„`Set`æ˜¯ä»€ä¹ˆç±»å‹å¹¶æ²¡æœ‰ä¿è¯ã€‚é€šè¿‡ä½¿ç”¨`toCollection`ï¼Œä½ å°±å¯ä»¥æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š

```java
Map<Dish.Type, HashSet<CaloricLevel>> typeSetMap =
        menu.stream().collect(Collectors.groupingBy(
                Dish::getType, Collectors.mapping(
                        dish -> {
                            if (dish.getCalories() <= 400) return CaloricLevel.DIET;
                            else if (dish.getCalories() <= 700) return CaloricLevel.NORMAL;
                            return CaloricLevel.FAT;
                        },
                        Collectors.toCollection(HashSet::new)
                )
        ));
```

## åˆ†åŒº

åˆ†åŒºæ˜¯åˆ†ç»„çš„ç‰¹æ®Šæƒ…å†µï¼šç”±ä¸€ä¸ªè°“è¯ï¼ˆè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼çš„å‡½æ•°ï¼‰ä½œä¸ºåˆ†ç±»å‡½æ•°ï¼Œå®ƒç§°ä¹‹ä¸º*åˆ†åŒºå‡½æ•°*ï¼Œåˆ†åŒºå‡½æ•°æœ€å¤šåˆ†ä¸ºä¸¤ç»„ï¼Œ`true`å’Œ`false`

ä¾‹å¦‚ï¼Œå°†èœå•æŒ‰ç…§ç´ é£Ÿå’Œéç´ é£Ÿåˆ†å¼€ ï¼š

```java
Map<Boolean, List<Dish>> dish = 
    menu
		.stream()
    	.collect(Collectors.partitioningBy(Dish::isVegetarian));
```

`partitioningBy`æœ‰ä¸€ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œå¯ä»¥ä¼ é€’ç¬¬äºŒä¸ªæ”¶é›†å™¨ï¼š

```java
// åŒºåˆ†ç´ é£Ÿå’Œéç´ é£Ÿæµï¼Œå¹¶æŒ‰ç…§é£Ÿç‰©ç±»åˆ«è¿›è¡Œåˆ†ç»„
Map<Boolean, Map<Dish.Type, List<Dish>>> map =
        menu.stream().collect(Collectors.partitioningBy(
                Dish::isVegetarian, Collectors.groupingBy(
                        Dish::getType
                )
        ));
```

æˆ–è€…è¯´ï¼Œè·å–åˆ°ç´ èœå’Œéç´ èœä¸­çƒ­é‡æœ€é«˜çš„èœè‚´ ï¼š

```java
// æŸ¥æ‰¾æ¯ä¸€ä¸ªå­ç»„ä¸­çƒ­é‡æœ€é«˜çš„èœ
Map<Dish.Type, Dish> dishMap = menu.stream().collect(
        Collectors.groupingBy(
                Dish::getType, Collectors.collectingAndThen(
                        Collectors.maxBy(
                                Comparator.comparingInt(Dish::getCalories))
                        , Optional::get
                )
        )
);
```

### å¯¹æ•°å­—æŒ‰è´¨æ•°å’Œéè´¨æ•°åˆ†åŒº

```java
public static void main(String[] args) {
    System.out.println(partitionPrimes(20));
}
/**
 * åˆ¤æ–­æŸæ•´æ•°æ˜¯å¦ä¸ºè´¨æ•°
 *
 * @param candidate æ•´æ•°
 * @return å¦‚æœæ˜¯è´¨æ•°è¿”å›trueï¼Œåä¹‹è¿”å›false
 */
public static boolean isPrime(int candidate) {
    return IntStream.range(2, candidate).noneMatch(
            i -> candidate % i == 0
    );
}
/**
 * @param n å‰Nä¸ªæ•°å­—
 * @return å°†å‰Nä¸ªæ•°å­—åˆ†ç»„ åˆ†ä¸ºè´¨æ•°å’Œéè´¨æ•°
 */
public static Map<Boolean, List<Integer>> partitionPrimes(int n) {
    return IntStream.rangeClosed(2, n).boxed()
            .collect(Collectors.partitioningBy(
                    i -> isPrime(i)
            ));
}
```

## æ”¶é›†å™¨æ¥å£

`Collector`æ¥å£å®šä¹‰ ï¼š

```java
public interface Collector<T, A, R> {
    Supplier<A> supplier();
    BiConsumer<A, T> accumulator();
    BinaryOperator<A> combiner();
    Function<A, R> finisher();
    Set<Characteristics> characteristics();
}
```

- `T`æ˜¯æµä¸­è¦æ”¶é›†çš„é¡¹ç›®çš„æ³›å‹
- `A`æ˜¯ç´¯åŠ å™¨çš„ç±»å‹ï¼Œç´¯åŠ å™¨æ˜¯åœ¨æ”¶é›†è¿‡ç¨‹ä¸­ç”¨äºç´¯ç§¯éƒ¨åˆ†ç»“æœçš„å¯¹è±¡
- `R`æ˜¯æ”¶é›†æ“ä½œå¾—åˆ°çš„å¯¹è±¡ï¼ˆé€šå¸¸ä½†ä¸ä¸€å®šæ˜¯é›†åˆï¼‰çš„ç±»å‹

### ç†è§£`Collector`æ¥å£å£°æ˜çš„æ–¹æ³•

#### 1. å»ºç«‹æ–°çš„ç»“æœå®¹å™¨ ï¼š`supplier`æ–¹æ³•

`supplier`æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª`Supplier`ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ— å‚æ•°å‡½æ•°ï¼Œåœ¨è°ƒç”¨æ—¶**å®ƒä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ç´¯åŠ å®ä¾‹ï¼Œä¾›æ•°æ®æ”¶é›†è¿‡ç¨‹ä½¿ç”¨**ã€‚

å¯¹äºæˆ‘ä»¬çš„`ToListCollector`æ¥è¯´ï¼Œ`supplier`è¿”å›ä¸€ä¸ªç©ºçš„`List`ï¼š

```java
public Supplier<List<T>> supplier(){
    // reutrn ()->new ArrayList<T>();
	return ArrayList::new;
}
```

#### 2. å°†å…ƒç´ æ·»åŠ åˆ°ç»“æœå®¹å™¨ï¼š`accumulator`æ–¹æ³•

**`accumulator`æ–¹æ³•ä¼šè¿”å›æ‰§è¡Œè§„çº¦æ“ä½œçš„å‡½æ•°**ã€‚å½“éå†åˆ°æµä¸­ç¬¬nä¸ªå…ƒç´ æ—¶ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œæ—¶ä¼šæœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¿å­˜è§„çº¦ç»“æœçš„ç´¯åŠ å™¨ï¼ˆå·²æ”¶é›†äº†æµä¸­å‰n-1ä¸ªé¡¹ç›®ï¼‰ï¼Œè¿˜æœ‰ç¬¬nä¸ªå…ƒç´ æœ¬èº«ã€‚

å¯¹äº`ToListCollector`æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ä»…ä»…ä¼šæŠŠå½“å‰é¡¹ç›®æ·»åŠ åˆ°å·²ç»éå†è¿‡çš„é¡¹ç›®çš„åˆ—è¡¨ ï¼š

```java
public BiConsumer<List<T>,T> accumulator(){
    return (list,item)->list.add(item);
}
```

#### 3. å¯¹ç»“æœå®¹å™¨åº”ç”¨åº”ç”¨è½¬æ¢æ–¹æ³•ï¼š`finisher`æ–¹æ³•

åœ¨éå†å®Œæµä¹‹åï¼Œ**`finisher`æ–¹æ³•å¿…é¡»è¿”å›åœ¨ç´¯ç§¯è¿‡ç¨‹çš„æœ€åè¦è°ƒç”¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿å°†ç´¯åŠ å™¨å¯¹è±¡è½¬åŒ–ä¸ºæ•´ä¸ªé›†åˆæ“ä½œçš„æœ€ç»ˆç»“æœ**ã€‚

å¯¹äº`ToListCollector`æ¥è¯´ï¼Œç´¯åŠ å™¨å¯¹è±¡åˆšå¥½æ˜¯æ°å¥½ç¬¦åˆé¢„æœŸçš„æœ€ç»ˆç»“æœï¼Œå› æ­¤æ— éœ€è¿›è¡Œè½¬æ¢ï¼š

```java
public Function<List<T>,List<T>> finisher(){
    return Function.identity();
}
```

è¿™ä¸‰ä¸ªæ–¹æ³•è¶³ä»¥å¯¹æµè¿›è¡Œé¡ºå¯»è§„çº¦

![](https://raw.githubusercontent.com/zhangzhaolin/StudyNotes/master/%E6%88%AA%E5%9B%BE/Java8%E5%AE%9E%E6%88%98/Character6/1.png)

#### 4. åˆå¹¶ä¸¤ä¸ªç»“æœçš„å®¹å™¨ ï¼š`combiner`æ–¹æ³•

`combiner`æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä¾›è§„çº¦æ“ä½œä½¿ç”¨çš„å‡½æ•°ï¼Œ**å®ƒå®šä¹‰äº†å¯¹æµçš„å„ä¸ªå­éƒ¨åˆ†è¿›è¡Œå¹¶è¡Œå¤„ç†æ—¶ï¼Œå„ä¸ªå­éƒ¨åˆ†è§„çº¦æ‰€å¾—åˆ°çš„ç´¯åŠ å™¨å¦‚ä½•åˆå¹¶**ã€‚

å¯¹äº`ToListCollector`æ–¹æ³•æ¥è¯´ï¼š

```java
public BinaryOperator<List<T>> combiner(){
    return (list1,list2)->{
        list1.addAll(list2);
    	return list1;
    }    
}
```

æœ‰äº†è¿™å››ä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥å¯¹æµè¿›è¡Œå¹¶è¡Œè§„çº¦äº†ã€‚å®ƒä¼šç”¨åˆ° Java7 ä¸­å¼•å…¥çš„åˆ†æ”¯/åˆå¹¶æ¡†æ¶å’Œ`Spliterator`æŠ½è±¡ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ç« ä¸­æåˆ°ã€‚